# MCP Server Setup Guide for Link Flame

This guide explains each Model Context Protocol (MCP) server configured in `.mcp.json` and how they benefit this e-commerce & blog platform.

## Overview

Link Flame uses 10 MCP servers to enhance AI agent capabilities across development, testing, database management, and research workflows.

---

## ðŸš€ Core Development Servers

### 1. next-devtools
**Status:** âœ… Ready (auto-configured)
**Purpose:** Real-time Next.js application introspection

**Capabilities:**
- Query current build/runtime/type errors
- Access development logs
- Inspect page routes and metadata
- View Server Actions and component hierarchies
- Access Next.js knowledge base

**When to use:**
- "What errors are in my application?"
- "Show me all routes in the app"
- "Help me debug this hydration error"
- "What Server Actions are available?"

**Setup:** None required - automatically connects when `npm run dev` runs

---

### 2. sequential-thinking
**Status:** âœ… Ready (auto-configured)
**Purpose:** Enhanced reasoning for complex multi-step problems

**Best for this project:**
- **Checkout Flow Logic** - Planning the complete user journey from cart â†’ payment â†’ confirmation
- **Cart State Management** - Reasoning about guest â†’ authenticated cart migrations
- **Database Migrations** - Planning schema changes without breaking existing data
- **Feature Planning** - Breaking down "add product reviews" into atomic steps
- **Bug Investigation** - Systematic debugging of complex issues

**Example prompts:**
- "Plan how to implement product variant support (size, color) with inventory tracking"
- "Debug why cart totals are incorrect when applying discount codes"
- "Design a migration strategy from SQLite to PostgreSQL for production"

**Setup:** None required - works out of the box

---

### 3. memory
**Status:** âœ… Ready (auto-configured)
**Purpose:** Persistent knowledge across coding sessions

**What it remembers:**
- Architecture decisions (why we chose NextAuth over Clerk)
- Completed TODO tasks and their outcomes
- Code patterns established in the project
- User preferences and workflows
- Known issues and their workarounds

**Example usage:**
- "Remember: All cart operations must validate quantity <= 999"
- "What did we decide about email service integration last session?"
- "Remind me why we use React Context for cart instead of Zustand"

**Benefits for this project:**
- Maintains consistency across development sessions
- Prevents re-deciding the same architectural questions
- Tracks progress on TODO.md tasks
- Remembers why certain patterns exist

**Setup:** None required - creates persistent memory automatically

---

## ðŸ—„ï¸ Database & Backend Servers

### 4. postgres
**Status:** âš ï¸ Requires PostgreSQL + configuration
**Purpose:** Direct PostgreSQL database queries and inspection

**When to enable:**
After migrating from SQLite to PostgreSQL for production, this enables:
- Schema inspection and analysis
- Performance query analysis
- Data exploration and validation
- Migration verification

**Setup:**
1. Set up PostgreSQL database:
```bash
# Install PostgreSQL (if not installed)
# Windows: Download from postgresql.org
# Mac: brew install postgresql@15
# Linux: sudo apt-get install postgresql

# Create database
createdb linkflame

# Update Prisma to use PostgreSQL
# In schema.prisma:
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
```

2. Update `.mcp.json` with your connection string:
```json
"env": {
  "POSTGRES_CONNECTION_STRING": "postgresql://user:password@localhost:5432/linkflame"
}
```

3. Run migrations:
```bash
npx prisma migrate dev
```

**Example queries:**
- "Show me all orders placed in the last 7 days"
- "What's the average cart value?"
- "Find products with no reviews"
- "Analyze slow queries in the orders table"

---

## ðŸ” Research & Documentation Servers

### 5. brave-search
**Status:** âš ï¸ Requires API key
**Purpose:** Web search for real-time information

**Perfect for:**
- **Next.js 16 features** - "What's new in Next.js 16 App Router?"
- **Stripe API updates** - "Latest Stripe webhook best practices 2025"
- **React 19 patterns** - "How to use React 19 use() hook with Suspense"
- **Library comparisons** - "Best email service for Next.js: Resend vs SendGrid vs AWS SES"
- **Security research** - "OWASP top 10 for e-commerce 2025"

**Setup:**
1. Get free API key from [brave.com/search/api](https://brave.com/search/api)
2. Update `.mcp.json`:
```json
"env": {
  "BRAVE_API_KEY": "BSA_YOUR_API_KEY_HERE"
}
```

**Alternative:** Remove this server if you don't need web search

---

### 6. fetch
**Status:** âœ… Ready (auto-configured)
**Purpose:** Fetch and parse web content

**Use cases for this project:**
- Read Stripe API documentation
- Check npm package README files
- Verify webhook payload formats
- Parse Next.js migration guides
- Fetch external API schemas

**Example prompts:**
- "Fetch the Stripe checkout session API docs"
- "Get the latest next-auth v5 migration guide"
- "Check the Radix UI Select API reference"
- "Read the Prisma best practices for PostgreSQL"

**Setup:** None required

---

## ðŸ§ª Testing & Quality Assurance

### 7. playwright
**Status:** âš ï¸ Requires Playwright installation
**Purpose:** End-to-end browser testing

**Critical test scenarios for e-commerce:**
- **Checkout Flow** - Add to cart â†’ checkout â†’ payment â†’ confirmation
- **Authentication** - Sign up â†’ sign in â†’ protected routes
- **Cart Operations** - Add/remove/update quantities â†’ persist on refresh
- **Guest to Auth Migration** - Cart items preserved after login
- **Product Browsing** - Categories, search, filters
- **Blog Navigation** - Posts, tags, categories

**Setup:**
```bash
# Install Playwright
npm install -D @playwright/test
npx playwright install

# Playwright is now available via MCP
```

**Example test requests:**
- "Write a Playwright test for the complete checkout flow"
- "Test that cart items persist after page refresh"
- "Verify authentication redirects work correctly"
- "Test product search with multiple filters"

**Benefits:**
- Automated regression testing
- Cross-browser compatibility verification
- Visual regression detection
- Performance measurement

---

## ðŸ”§ Version Control Servers

### 8. git
**Status:** âœ… Ready (auto-configured)
**Purpose:** Git operations without leaving the agent

**Capabilities:**
- View commit history
- Check diff of changes
- Create branches
- View file history
- Analyze code churn

**Example usage:**
- "Show commits from the last week"
- "What changed in the cart API since last month?"
- "Create a branch for implementing email notifications"
- "Show me the diff for components/checkout"

**Setup:** None required - works with your existing Git repository

---

### 9. github
**Status:** âš ï¸ Requires GitHub token
**Purpose:** GitHub API integration

**Enables:**
- Create issues for bugs/features
- Manage pull requests
- Query repository statistics
- Track project milestones
- Review code comments

**Setup:**
1. Create GitHub Personal Access Token:
   - Go to https://github.com/settings/tokens
   - Generate new token (classic)
   - Select scopes: `repo`, `read:org`, `workflow`
   - Copy the token

2. Update `.mcp.json`:
```json
"env": {
  "GITHUB_PERSONAL_ACCESS_TOKEN": "ghp_YourTokenHere"
}
```

**Example usage:**
- "Create an issue for implementing email notifications"
- "Show open PRs for this repository"
- "What's the commit activity for the last month?"
- "List all TODO comments in the codebase"

---

### 10. filesystem
**Status:** â„¹ï¸ Optional (redundant with Claude Code)
**Purpose:** File operations for other MCP clients

**Note:** Claude Code already has robust file system access. This server is included for:
- Compatibility with other MCP clients
- Standardized file operations across tools
- Future-proofing the MCP setup

**Setup:** None required

---

## ðŸŽ¯ Recommended Configuration for Link Flame

### Minimal Setup (Start Here)
Enable these essential servers:
1. âœ… **next-devtools** - Core Next.js introspection
2. âœ… **sequential-thinking** - Complex problem solving
3. âœ… **memory** - Session continuity
4. âœ… **fetch** - Documentation access

**No API keys needed, works immediately**

### Production-Ready Setup
Add when ready for production:
5. âš ï¸ **postgres** - After PostgreSQL migration
6. âš ï¸ **playwright** - For E2E testing
7. âš ï¸ **git** - Enhanced version control
8. âš ï¸ **github** - Issue/PR management

### Optional Enhancements
Add for advanced workflows:
9. âš ï¸ **brave-search** - Real-time web research
10. â„¹ï¸ **filesystem** - Multi-agent compatibility

---

## ðŸ“ Environment Variables Summary

Create a `.env.mcp` file (add to `.gitignore`):

```env
# Brave Search (optional)
BRAVE_API_KEY=BSA_your_api_key_here

# GitHub (optional)
GITHUB_PERSONAL_ACCESS_TOKEN=ghp_your_token_here

# PostgreSQL (when migrating from SQLite)
POSTGRES_CONNECTION_STRING=postgresql://user:password@localhost:5432/linkflame
```

Then reference in `.mcp.json`:
```json
"env": {
  "BRAVE_API_KEY": "${BRAVE_API_KEY}"
}
```

---

## ðŸš€ Getting Started

1. **Verify MCP is working:**
```bash
npm run dev
# Agent should auto-connect to http://localhost:3000/_next/mcp
```

2. **Test with a simple query:**
Ask your agent: "What errors are currently in the application?"

3. **Enable additional servers as needed:**
- Start with minimal setup (no configuration needed)
- Add PostgreSQL server when migrating databases
- Add Playwright when ready for E2E testing
- Add GitHub/Brave when you need those integrations

---

## ðŸ” Project-Specific MCP Use Cases

### E-commerce Workflows

**Implementing Product Variants**
```
Agent: "Use sequential-thinking to plan adding product variants (size, color)"
â†’ Analyzes schema changes, cart logic, checkout flow, inventory tracking
â†’ Provides step-by-step implementation plan
```

**Debugging Checkout Issues**
```
Agent: "Check next-devtools for checkout errors"
â†’ Shows runtime errors from Stripe integration
â†’ Provides Server Action details
â†’ Suggests fixes based on error context
```

**Testing Payment Flow**
```
Agent: "Write Playwright test for complete checkout with test card"
â†’ Generates E2E test covering:
  - Add product to cart
  - Proceed to checkout
  - Fill Stripe test card (4242 4242 4242 4242)
  - Verify order confirmation
  - Check order appears in database
```

### Blog Management

**Content Migration**
```
Agent: "Use postgres to analyze all blog posts without categories"
â†’ Queries database directly
â†’ Provides migration plan
â†’ Suggests category assignment strategy
```

**SEO Optimization**
```
Agent: "Use brave-search to research Next.js 16 SEO best practices"
â†’ Finds latest guidance
â†’ Suggests metadata improvements
â†’ Provides structured data examples
```

### Database Operations

**Schema Analysis**
```
Agent: "Use postgres to show table relationships"
â†’ Visualizes User â†’ Cart â†’ Order relationships
â†’ Identifies missing indexes
â†’ Suggests query optimizations
```

**Performance Monitoring**
```
Agent: "Use postgres to find slow queries"
â†’ Analyzes query execution times
â†’ Suggests index additions
â†’ Provides query optimization recommendations
```

---

## ðŸ“Š MCP Server Comparison

| Server | Setup Effort | Use Frequency | Project Impact |
|--------|--------------|---------------|----------------|
| next-devtools | âœ… None | ðŸ”¥ High | Critical - core dev tool |
| sequential-thinking | âœ… None | ðŸ”¥ High | Critical - complex features |
| memory | âœ… None | ðŸ”¥ High | Critical - consistency |
| fetch | âœ… None | âš¡ Medium | Important - research |
| git | âœ… None | âš¡ Medium | Important - version control |
| playwright | âš ï¸ Low | âš¡ Medium | Important - quality assurance |
| postgres | âš ï¸ Medium | ðŸ’¡ Low (until production) | Future - production database |
| brave-search | âš ï¸ Low | ðŸ’¡ Low | Optional - web research |
| github | âš ï¸ Low | ðŸ’¡ Low | Optional - project management |
| filesystem | â„¹ï¸ None | â„ï¸ Minimal | Compatibility only |

---

## ðŸŽ“ Learning Resources

- [MCP Documentation](https://modelcontextprotocol.io)
- [Next.js MCP Guide](https://nextjs.org/docs/app/api-reference/cli/next#enabling-mcp-server)
- [Playwright MCP](https://github.com/microsoft/playwright-mcp)
- [Sequential Thinking Patterns](https://modelcontextprotocol.io/examples/sequential-thinking)

---

## ðŸ› Troubleshooting

**MCP server not connecting:**
1. Ensure dev server is running: `npm run dev`
2. Check MCP endpoint: `http://localhost:3000/_next/mcp`
3. Restart your coding agent
4. Check `.mcp.json` syntax (no trailing commas)

**Environment variables not loading:**
1. Verify `.env.mcp` exists and has correct values
2. Check variable names match in `.mcp.json`
3. Restart agent after environment changes

**Package not found errors:**
1. MCP servers are run via `npx -y` (auto-installs on first use)
2. Ensure you have internet connection for package downloads
3. Clear npm cache if issues persist: `npm cache clean --force`

---

## ðŸ’¡ Tips & Best Practices

1. **Start minimal** - Enable servers as you need them, not all at once
2. **Use memory** - Always ask agent to remember important decisions
3. **Combine servers** - "Use sequential-thinking + fetch to plan email integration"
4. **Test with playwright** - Write E2E tests for critical paths (checkout, auth)
5. **Monitor with next-devtools** - Check errors before manual testing
6. **Research with brave-search** - Stay updated on best practices
7. **Document with memory** - Ask agent to remember why you made architectural choices

---

**Last Updated:** 2025-11-07
**Link Flame Version:** Next.js 16.0.1 with React 19
